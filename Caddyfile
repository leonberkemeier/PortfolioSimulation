# Caddyfile for Trading Simulator Deployment with Docker
# Replace yourdomain.com with your actual domain

yourdomain.com {
    # Frontend - Serve React app
    root * /var/www/trading-simulator/frontend/dist
    
    # Try files first, then fallback to index.html for SPA routing
    try_files {path} /index.html
    file_server

    # Backend API - Reverse proxy to Docker container
    handle /api/* {
        reverse_proxy localhost:8001
    }

    # WebSocket support (if needed in future)
    @websockets {
        header Connection *Upgrade*
        header Upgrade websocket
    }
    reverse_proxy @websockets localhost:8001

    # Security headers
    header {
        # Prevent clickjacking
        X-Frame-Options "DENY"
        # Prevent MIME type sniffing
        X-Content-Type-Options "nosniff"
        # Enable XSS protection
        X-XSS-Protection "1; mode=block"
        # Referrer policy
        Referrer-Policy "strict-origin-when-cross-origin"
        # Remove server header
        -Server
    }

    # Enable gzip compression
    encode gzip

    # Logging
    log {
        output file /var/log/caddy/trading-simulator.log
        format json
    }
}

# Optional: Redirect www to non-www
www.yourdomain.com {
    redir https://yourdomain.com{uri} permanent
}
